(()=>{var e={};e.id=310,e.ids=[310],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},18461:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>x,routeModule:()=>g,serverHooks:()=>m,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>y});var s={};r.r(s),r.d(s,{GET:()=>d,dynamic:()=>l,runtime:()=>c});var n=r(96559),o=r(48088),i=r(37719),a=r(32190);let c="nodejs",l="force-dynamic",u=new Map,p=()=>process.env.GENIUS_ACCESS_TOKEN||"dexbGLGUioHh86mxhKllbVrHmhtD9mRFzz3qb72lZObWxymZ70uFJhnv3frWAqhV";async function d(e){let{searchParams:t}=new URL(e.url),r=t.get("track")?.trim(),s=t.get("artist")?.trim(),n=t.get("nocache");if(console.log("[Lyrics API] Request received:",{track:r,artist:s,noCache:n}),!r)return a.NextResponse.json({error:"Missing track"},{status:400});let o=p();if(console.log("[Lyrics API] Token check:",{hasToken:!!o,tokenLength:o?.length}),!o)return console.warn("Lyrics API: Genius token missing. Found GENIUS-like env keys:",Object.keys(process.env).filter(e=>e.includes("GENIUS"))),a.NextResponse.json({error:"GENIUS_ACCESS_TOKEN not configured. Please add your Genius API token to environment variables.",setup:"Get your token from: https://genius.com/api-clients"},{status:500});try{let e=`${(r||"").toLowerCase()}|${(s||"").toLowerCase()}`;n&&u.delete(e);let t=u.get(e);if(t&&Date.now()-t.ts<216e5)return console.log("[Lyrics][cache] hit",e),a.NextResponse.json(t,{headers:{"Cache-Control":"public, s-maxage=21600, stale-while-revalidate=3600"}});let i=s?`${r} ${s}`:r;console.log("[Lyrics][search] Query:",i);let c=await fetch(`https://api.genius.com/search?q=${encodeURIComponent(i)}`,{headers:{Authorization:`Bearer ${o}`,"User-Agent":"MusicStreamApp/1.0"}});if(!c.ok)throw Error(`Genius API search failed: ${c.status} ${c.statusText}`);let l=await c.json(),p=l.response?.hits||[];if(!p.length)return console.log("[Lyrics][search] No results found for:",i),a.NextResponse.json({lyrics:null,synced:!1},{status:200});let d=p[0].result;console.log("[Lyrics][found] song:",d.title,"by",d.primary_artist.name);let g=null;try{let e=d.url;if(e){let t;console.log("[Lyrics][fetch] trying URL:",e);let r=await fetch(e,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115 Safari/537.36",Accept:"text/html"}}),s=await r.text(),n="",o=/<div[^>]*data-lyrics-container="true"[^>]*>([\s\S]*?)<\/div>/gi,i=/<div[^>]*class="[^"]*Lyrics__Container[^"]*"[^>]*>([\s\S]*?)<\/div>/gi,a=[];for(;t=o.exec(s);)a.push(t[1]);for(;t=i.exec(s);)a.push(t[1]);a.length&&(n=a.map(e=>e.replace(/<br\s*\/?>(?=\n|\r|\s|$)/gi,"\n").replace(/<[^>]+>/g,"").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&nbsp;/g," ").replace(/&#(\d+);/g,(e,t)=>String.fromCharCode(Number(t))).replace(/&#x([0-9a-fA-F]+);/g,(e,t)=>String.fromCharCode(parseInt(t,16)))).join("\n").replace(/[ \t]*\n[ \t]*/g,"\n").replace(/\n{3,}/g,"\n\n").trim()),n&&(g=n,console.log("[Lyrics][success] extracted lyrics length:",g.length))}}catch(e){console.warn("[Lyrics][error] Failed to fetch lyrics for",d.title,e)}if(!g)return console.log("[Lyrics][parse] empty for",i),a.NextResponse.json({lyrics:null,synced:!1},{status:200});let h={lyrics:g.split(/\r?\n/).filter(e=>{let t=e.trim();return!t||!(/^\d+\s+Contributors?/i.test(t)||/^Translations$/i.test(t)||/^Embed$/i.test(t)||/Embed$/i.test(t)||/^\[.*\]$/i.test(t))}).join("\n").replace(/\n{3,}/g,"\n\n").trim(),synced:!1};return u.set(e,{...h,ts:Date.now()}),a.NextResponse.json(h,{headers:{"Cache-Control":"public, s-maxage=21600, stale-while-revalidate=3600"}})}catch(e){return console.error("Lyrics API error",e),a.NextResponse.json({error:"Failed to fetch lyrics",details:void 0},{status:500})}}let g=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/lyrics/route",pathname:"/api/lyrics",filename:"route",bundlePath:"app/api/lyrics/route"},resolvedPagePath:"F:\\Music-Project\\group\\music-streaming_NOW_2\\app\\api\\lyrics\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:h,workUnitAsyncStorage:y,serverHooks:m}=g;function x(){return(0,i.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:y})}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[719,580],()=>r(18461));module.exports=s})();