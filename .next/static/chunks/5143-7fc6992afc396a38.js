"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5143],{330:(e,t,a)=>{a.d(t,{d:()=>m});var n=a(5155),l=a(6874),r=a.n(l),i=a(5695),s=a(2115),d=a(9613),o=a(3999);let u=d.Kq,c=d.bL,h=d.l9,f=s.forwardRef((e,t)=>{let{className:a,sideOffset:l=4,...r}=e;return(0,n.jsx)(d.UC,{ref:t,sideOffset:l,className:(0,o.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...r})});function m(e){let{artists:t,artistIds:a,maxLength:l=30,className:s="text-sm text-zinc-400 truncate",showLinks:d=!1,onClick:o,hideWhenEmpty:m=!1}=e,p=(0,i.useRouter)(),g=(e,t,a)=>{o&&o(e),e.preventDefault(),e.stopPropagation(),a?p.push("/artist/".concat(a)):p.push("/search?q=".concat(encodeURIComponent(t)))};if(!t||0===t.length)return m?null:(0,n.jsx)("span",{className:s});let v=t.join(", ");if(!(v.length>l))return d?(0,n.jsx)("span",{className:s,children:t.map((e,l)=>{let i=null==a?void 0:a[l],s=i?"/artist/".concat(i):"#";return(0,n.jsxs)("span",{children:[(0,n.jsx)(r(),{href:s,className:"hover:text-white hover:underline transition-colors",onClick:t=>g(t,e,i),children:e}),l<t.length-1&&", "]},l)})}):(0,n.jsx)("span",{className:s,onClick:o,children:v});let x=(e,t)=>{if(e.length<=t)return e;let a=e.substring(0,t),n=a.lastIndexOf(","),l=a.lastIndexOf(" ");return n>0&&n>.5*t?e.substring(0,n)+"...":l>0&&l>.4*t?e.substring(0,l)+"...":a+"..."},y=x(v,l);return(0,n.jsx)(u,{delayDuration:100,children:(0,n.jsxs)(c,{children:[(0,n.jsx)(h,{asChild:!0,children:(0,n.jsx)("span",{className:s,onClick:o,style:{display:"inline"},children:d?(0,n.jsx)("span",{children:(()=>{var e;let i=0,s=[],d=[];for(let e=0;e<t.length;e++){let n=t[e],r=0===e?n:", "+n;if(i+r.length<=l)s.push(n),d.push(null==a?void 0:a[e]),i+=r.length;else{let t=l-i;if(t>3&&n.length>3){let l=n.substring(0,t-3)+"...";s.push(l),d.push(null==a?void 0:a[e])}break}}if(0===s.length&&t.length>0){let e=t[0],i=null==a?void 0:a[0],s=x(e,l-3);return(0,n.jsxs)("span",{children:[(0,n.jsx)(r(),{href:i?"/artist/".concat(i):"#",className:"hover:text-white hover:underline transition-colors",onClick:t=>g(t,e,i),children:s}),s.endsWith("...")?"":"..."]})}return(0,n.jsxs)(n.Fragment,{children:[s.map((e,a)=>{let l=e.endsWith("..."),i=l?t[a]:e,o=d[a];return(0,n.jsxs)("span",{children:[(0,n.jsx)(r(),{href:o?"/artist/".concat(o):"#",className:"hover:text-white hover:underline transition-colors",onClick:e=>g(e,i,o),children:e}),a<s.length-1&&!l&&", "]},a)}),s.length<t.length&&!(null===(e=s[s.length-1])||void 0===e?void 0:e.endsWith("..."))&&"..."]})})()}):y})}),(0,n.jsx)(f,{side:"top",align:"start",sideOffset:6,className:"bg-zinc-800 border-zinc-700 text-white max-w-xs",children:(0,n.jsx)("p",{children:v})})]})})}f.displayName=d.UC.displayName},9338:(e,t,a)=>{a.d(t,{F:()=>d,PlayerProvider:()=>s});var n=a(5155),l=a(2115),r=a(875);let i=(0,l.createContext)(void 0);function s(e){let{children:t}=e,a=(0,l.useRef)(null),[s,d]=(0,l.useState)(null),[o,u]=(0,l.useState)([]),[c,h]=(0,l.useState)(-1),[f,m]=(0,l.useState)(!1),[p,g]=(0,l.useState)(.8),[v,x]=(0,l.useState)(null),[y,b]=(0,l.useState)(0),[k,w]=(0,l.useState)(0),[C,j]=(0,l.useState)(!1),[E,S]=(0,l.useState)("none"),[P,N]=(0,l.useState)([]),[L,M]=(0,l.useState)(!1);(0,l.useEffect)(()=>{try{let e=localStorage.getItem("last_track_id");if(!e)return;(async()=>{try{let t=await r.i.getTrack(e);try{let e=await r.i.getAlbum(t.album_id);t.album_images=e.images||[]}catch(e){}d(t),u([t]),h(0)}catch(e){console.warn("[Player] Failed to restore last track",e)}})()}catch(e){}},[]),(0,l.useEffect)(()=>{a.current&&(a.current.volume=p)},[p]);let I=(0,l.useCallback)(async function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];try{console.debug("[Player] loadAndMaybePlay",{trackId:e.id,name:e.name,autoplay:t});let n=await r.i.playTrack(e.id);x(n),a.current&&(a.current.src=n,t&&(await a.current.play(),m(!0))),M(!1)}catch(e){console.error("Failed to load stream",e)}},[]),_=(0,l.useCallback)(async(e,t)=>{var a,n;let l=null===(n=null==t?void 0:t.autoplay)||void 0===n||n;if(console.debug("[Player] play",{trackId:e.id,name:e.name,autoplay:l,queueLen:null==t?void 0:null===(a=t.queue)||void 0===a?void 0:a.length}),null==t?void 0:t.queue){let a=t.queue;N(a);let n=[...a].sort(()=>Math.random()-.5);u(n),j(!0);let l=n.findIndex(t=>t.id===e.id);h(l>=0?l:0)}d(e);try{localStorage.setItem("last_track_id",e.id)}catch(e){}await I(e,l)},[I]),q=(0,l.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!e.length)return;console.debug("[Player] playQueue",{startIndex:t,tracks:e.map(e=>({id:e.id,name:e.name}))}),N(e);let a=[...e].sort(()=>Math.random()-.5);j(!0);let n=e[t],l=a.findIndex(e=>e.id===n.id);t=l>=0?l:0,u(a);let r=Math.max(0,Math.min(t,a.length-1));h(r);let i=a[r];d(i),await I(i,!0)},[I]),z=(0,l.useCallback)(()=>{a.current&&(a.current.pause(),m(!1))},[]),F=(0,l.useCallback)(()=>{let e=a.current;if(e){if((!e.src||0===e.src.length)&&s){I(s,!0);return}e.play().then(()=>m(!0)).catch(()=>{})}},[s,I]),T=(0,l.useCallback)(async()=>{if(0===o.length)return;let e=c+1;if(e>=o.length){if("all"!==E)return;e=0}h(e);let t=o[e];d(t),await I(t,!0)},[o,c,E,I]),O=(0,l.useCallback)(async()=>{if(0===o.length)return;let e=c-1;if(e<0){if("all"!==E)return;e=o.length-1}h(e);let t=o[e];d(t),await I(t,!0)},[o,c,E,I]),R=(0,l.useCallback)(e=>{g(Math.max(0,Math.min(1,e)))},[]),U=(0,l.useCallback)(e=>{let t=a.current;if(!t)return;let n=Math.max(0,Math.min(e,isFinite(t.duration)?t.duration:e));t.currentTime=n,b(n)},[]),W=(0,l.useCallback)(()=>{j(e=>{let t=!e;if(t){if(o.length>0){let e=[...o].sort(()=>Math.random()-.5);if(u(e),s){let t=e.findIndex(e=>e.id===s.id);t>=0&&h(t)}}}else console.log("[Player] Shuffle paused - keeping current queue order");return t})},[o,s]),A=(0,l.useCallback)(()=>{S(e=>"none"===e?"all":"all"===e?"one":"none")},[]);(0,l.useEffect)(()=>{let e=a.current;if(!e)return;let t=()=>{let t=e.currentTime||0;b(t),s&&!L&&t>30&&(t>.5*e.duration||t>30)&&(M(!0),window.addToHistoryGlobal&&window.addToHistoryGlobal(s.id))},n=()=>w(e.duration&&isFinite(e.duration)?e.duration:0),l=()=>m(!0),r=()=>m(!1),i=()=>{o.length>0&&("one"===E?s&&I(s,!0):C?T():(console.log("[Player] Shuffle paused - stopping playback after track ends"),m(!1)))};return e.addEventListener("timeupdate",t),e.addEventListener("loadedmetadata",n),e.addEventListener("play",l),e.addEventListener("pause",r),e.addEventListener("ended",i),()=>{e.removeEventListener("timeupdate",t),e.removeEventListener("loadedmetadata",n),e.removeEventListener("play",l),e.removeEventListener("pause",r),e.removeEventListener("ended",i)}},[o,E,s,T,I,C,L]);let D=(0,l.useMemo)(()=>({current:s,queue:o,isPlaying:f,volume:p,streamUrl:v,currentTime:y,duration:k,isShuffled:C,loopMode:E,play:_,playQueue:q,pause:z,resume:F,next:T,prev:O,setVolume:R,seek:U,toggleShuffle:W,toggleLoop:A}),[s,o,f,p,v,y,k,C,E,_,q,z,F,T,O,R,U,W,A]);return(0,n.jsxs)(i.Provider,{value:D,children:[t,(0,n.jsx)("audio",{ref:a})]})}function d(){let e=(0,l.useContext)(i);if(!e)throw Error("usePlayer must be used within PlayerProvider");return e}}}]);