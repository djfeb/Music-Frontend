(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4256],{1154:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});let l=(0,a(9946).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},2355:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});let l=(0,a(9946).A)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},5695:(e,t,a)=>{"use strict";var l=a(8999);a.o(l,"useParams")&&a.d(t,{useParams:function(){return l.useParams}}),a.o(l,"useRouter")&&a.d(t,{useRouter:function(){return l.useRouter}}),a.o(l,"useSearchParams")&&a.d(t,{useSearchParams:function(){return l.useSearchParams}})},7201:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>f});var l=a(5155),r=a(2115),s=a(5695),n=a(6766),i=a(2355),u=a(1154),c=a(5690),d=a(5970),o=a(7168),m=a(9338),h=a(875);function f(){let{id:e}=(0,s.useParams)(),t=(0,s.useRouter)(),a=(0,m.F)(),[f,v]=(0,r.useState)(null),[x,y]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{(async()=>{try{if(!e)return;let t=await h.i.getTrack(e);try{let e=await h.i.getAlbum(t.album_id);t.album_images=e.images||[]}catch(e){}v(t),a.play(t,{queue:[t],autoplay:!0})}catch(e){t.push("/")}finally{y(!1)}})()},[e]),(0,l.jsxs)("div",{className:"flex h-[calc(100vh-5rem)] bg-black text-white overflow-hidden",children:[(0,l.jsx)(d.B,{}),(0,l.jsx)("main",{className:"flex-1 overflow-auto",children:(0,l.jsxs)("div",{className:"px-4 sm:px-6 md:px-8 py-6",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,l.jsx)(o.$,{variant:"ghost",size:"icon",className:"hidden sm:flex rounded-full h-10 w-10",onClick:()=>t.back(),children:(0,l.jsx)(i.A,{className:"h-6 w-6"})}),(0,l.jsx)("h1",{className:"text-2xl font-bold",children:"Track"})]}),x?(0,l.jsxs)("div",{className:"flex items-center justify-center py-24 text-zinc-400",children:[(0,l.jsx)(u.A,{className:"h-6 w-6 animate-spin mr-2"})," Loading track..."]}):f?(0,l.jsxs)("div",{className:"flex items-center gap-6",children:[(0,l.jsx)("div",{className:"relative w-28 h-28 bg-zinc-800 rounded overflow-hidden",children:f.album_images&&f.album_images.length>0?(0,l.jsx)(n.default,{src:f.album_images[0].url,alt:f.name,fill:!0,className:"object-cover"}):(0,l.jsx)("div",{className:"w-full h-full flex items-center justify-center text-3xl",children:"\uD83C\uDFB5"})}),(0,l.jsxs)("div",{className:"min-w-0",children:[(0,l.jsx)("div",{className:"text-xl font-semibold truncate",children:f.name}),(0,l.jsx)("div",{className:"text-sm text-zinc-400 truncate",children:(f.artists||[]).join(", ")}),(0,l.jsxs)(o.$,{className:"mt-4 bg-green-500 hover:bg-green-400 text-black",onClick:()=>a.play(f,{queue:[f],autoplay:!0}),children:[(0,l.jsx)(c.A,{className:"h-4 w-4 mr-2"})," Play"]})]})]}):(0,l.jsx)("div",{className:"text-zinc-400",children:"Track not found."})]})})]})}},8426:(e,t,a)=>{Promise.resolve().then(a.bind(a,7201))},9338:(e,t,a)=>{"use strict";a.d(t,{F:()=>u,PlayerProvider:()=>i});var l=a(5155),r=a(2115),s=a(875);let n=(0,r.createContext)(void 0);function i(e){let{children:t}=e,a=(0,r.useRef)(null),[i,u]=(0,r.useState)(null),[c,d]=(0,r.useState)([]),[o,m]=(0,r.useState)(-1),[h,f]=(0,r.useState)(!1),[v,x]=(0,r.useState)(.8),[y,g]=(0,r.useState)(null),[b,p]=(0,r.useState)(0),[k,w]=(0,r.useState)(0),[j,N]=(0,r.useState)(!1),[P,S]=(0,r.useState)("none"),[C,E]=(0,r.useState)([]),[_,L]=(0,r.useState)(!1);(0,r.useEffect)(()=>{try{let e=localStorage.getItem("last_track_id");if(!e)return;(async()=>{try{let t=await s.i.getTrack(e);try{let e=await s.i.getAlbum(t.album_id);t.album_images=e.images||[]}catch(e){}u(t),d([t]),m(0)}catch(e){console.warn("[Player] Failed to restore last track",e)}})()}catch(e){}},[]),(0,r.useEffect)(()=>{a.current&&(a.current.volume=v)},[v]);let M=(0,r.useCallback)(async function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];try{console.debug("[Player] loadAndMaybePlay",{trackId:e.id,name:e.name,autoplay:t});let l=await s.i.playTrack(e.id);g(l),a.current&&(a.current.src=l,t&&(await a.current.play(),f(!0))),L(!1)}catch(e){console.error("Failed to load stream",e)}},[]),A=(0,r.useCallback)(async(e,t)=>{var a,l;let r=null===(l=null==t?void 0:t.autoplay)||void 0===l||l;if(console.debug("[Player] play",{trackId:e.id,name:e.name,autoplay:r,queueLen:null==t?void 0:null===(a=t.queue)||void 0===a?void 0:a.length}),null==t?void 0:t.queue){let a=t.queue;E(a);let l=[...a].sort(()=>Math.random()-.5);d(l),N(!0);let r=l.findIndex(t=>t.id===e.id);m(r>=0?r:0)}u(e);try{localStorage.setItem("last_track_id",e.id)}catch(e){}await M(e,r)},[M]),T=(0,r.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!e.length)return;console.debug("[Player] playQueue",{startIndex:t,tracks:e.map(e=>({id:e.id,name:e.name}))}),E(e);let a=[...e].sort(()=>Math.random()-.5);N(!0);let l=e[t],r=a.findIndex(e=>e.id===l.id);t=r>=0?r:0,d(a);let s=Math.max(0,Math.min(t,a.length-1));m(s);let n=a[s];u(n),await M(n,!0)},[M]),q=(0,r.useCallback)(()=>{a.current&&(a.current.pause(),f(!1))},[]),F=(0,r.useCallback)(()=>{let e=a.current;if(e){if((!e.src||0===e.src.length)&&i){M(i,!0);return}e.play().then(()=>f(!0)).catch(()=>{})}},[i,M]),I=(0,r.useCallback)(async()=>{if(0===c.length)return;let e=o+1;if(e>=c.length){if("all"!==P)return;e=0}m(e);let t=c[e];u(t),await M(t,!0)},[c,o,P,M]),z=(0,r.useCallback)(async()=>{if(0===c.length)return;let e=o-1;if(e<0){if("all"!==P)return;e=c.length-1}m(e);let t=c[e];u(t),await M(t,!0)},[c,o,P,M]),R=(0,r.useCallback)(e=>{x(Math.max(0,Math.min(1,e)))},[]),B=(0,r.useCallback)(e=>{let t=a.current;if(!t)return;let l=Math.max(0,Math.min(e,isFinite(t.duration)?t.duration:e));t.currentTime=l,p(l)},[]),D=(0,r.useCallback)(()=>{N(e=>{let t=!e;if(t){if(c.length>0){let e=[...c].sort(()=>Math.random()-.5);if(d(e),i){let t=e.findIndex(e=>e.id===i.id);t>=0&&m(t)}}}else console.log("[Player] Shuffle paused - keeping current queue order");return t})},[c,i]),G=(0,r.useCallback)(()=>{S(e=>"none"===e?"all":"all"===e?"one":"none")},[]);(0,r.useEffect)(()=>{let e=a.current;if(!e)return;let t=()=>{let t=e.currentTime||0;p(t),i&&!_&&t>30&&(t>.5*e.duration||t>30)&&(L(!0),window.addToHistoryGlobal&&window.addToHistoryGlobal(i.id))},l=()=>w(e.duration&&isFinite(e.duration)?e.duration:0),r=()=>f(!0),s=()=>f(!1),n=()=>{c.length>0&&("one"===P?i&&M(i,!0):j?I():(console.log("[Player] Shuffle paused - stopping playback after track ends"),f(!1)))};return e.addEventListener("timeupdate",t),e.addEventListener("loadedmetadata",l),e.addEventListener("play",r),e.addEventListener("pause",s),e.addEventListener("ended",n),()=>{e.removeEventListener("timeupdate",t),e.removeEventListener("loadedmetadata",l),e.removeEventListener("play",r),e.removeEventListener("pause",s),e.removeEventListener("ended",n)}},[c,P,i,I,M,j,_]);let H=(0,r.useMemo)(()=>({current:i,queue:c,isPlaying:h,volume:v,streamUrl:y,currentTime:b,duration:k,isShuffled:j,loopMode:P,play:A,playQueue:T,pause:q,resume:F,next:I,prev:z,setVolume:R,seek:B,toggleShuffle:D,toggleLoop:G}),[i,c,h,v,y,b,k,j,P,A,T,q,F,I,z,R,B,D,G]);return(0,l.jsxs)(n.Provider,{value:H,children:[t,(0,l.jsx)("audio",{ref:a})]})}function u(){let e=(0,r.useContext)(n);if(!e)throw Error("usePlayer must be used within PlayerProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[9135,3965,3374,2390,1835,1322,5970,8441,1684,7358],()=>t(8426)),_N_E=e.O()}]);